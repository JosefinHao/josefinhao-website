{% extends "base.html" %}

{% block title %}Cat Cafe - Josefin Hao{% endblock %}

{% block body_attrs %} data-page="cat-cafe"{% endblock %}

{% block content %}
<div class="cat-cafe-container">
    <!-- Welcome message -->
    <div class="cat-cafe-intro">
        <h1>üê± Welcome to the Cozy Cat Cafe</h1>
        <p>Play games to exercise the cat and earn points. Use points to feed the cat.</p>
    </div>

    <!-- Food Bowl Icon (Left Side) -->
    <div class="food-bowl-container">
        <button class="food-bowl-btn" id="foodBowlBtn" title="Feed Cat (10 points)">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <!-- Bowl -->
                <path d="M4 10 C4 10, 5 16, 12 16 C19 16, 20 10, 20 10 L4 10 Z" fill="currentColor" opacity="0.3"/>
                <path d="M4 10 C4 10, 5 16, 12 16 C19 16, 20 10, 20 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <!-- Food -->
                <circle cx="12" cy="8" r="1.5" fill="currentColor"/>
                <circle cx="9" cy="9" r="1" fill="currentColor"/>
                <circle cx="15" cy="9" r="1" fill="currentColor"/>
            </svg>
        </button>
        <div class="points-display">
            <span class="points-label">Points:</span>
            <span class="points-value" id="pointsDisplay">0</span>
        </div>
        <div class="size-display">
            <span class="size-label">Cat Size:</span>
            <span class="size-value" id="catSizeDisplay">1.0</span>
        </div>
    </div>

    <!-- Game Icons Container (Right Side) -->
    <div class="game-icons-right">
        <!-- Wand Game Icon -->
        <button class="game-icon-btn wand-game-btn" id="wandGameBtn" title="Play Wand Game">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="2" y1="22" x2="14" y2="10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                <ellipse cx="16.5" cy="7.5" rx="3" ry="5" transform="rotate(-45 16.5 7.5)" fill="currentColor" opacity="0.7"/>
                <ellipse cx="18" cy="6" rx="2.5" ry="4.5" transform="rotate(-30 18 6)" fill="currentColor" opacity="0.5"/>
                <ellipse cx="15" cy="9" rx="2.5" ry="4.5" transform="rotate(-60 15 9)" fill="currentColor" opacity="0.6"/>
                <path d="M14 10 Q16 8 17 7" stroke="currentColor" stroke-width="1" stroke-linecap="round" fill="none"/>
            </svg>
        </button>

        <!-- Yarn Ball Game Icon -->
        <button class="game-icon-btn yarn-game-btn" id="yarnGameBtn" title="Play Yarn Ball Bounce">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="2"/>
                <path d="M4 12 Q8 8, 12 12 T20 12" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <path d="M12 4 Q8 8, 12 12 T12 20" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <circle cx="12" cy="12" r="2" fill="currentColor"/>
            </svg>
        </button>

        <!-- Meow Melody Game Icon -->
        <button class="game-icon-btn melody-game-btn" id="melodyGameBtn" title="Play Meow Melody">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 18V5L21 3V16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="6" cy="18" r="3" stroke="currentColor" stroke-width="2"/>
                <circle cx="18" cy="16" r="3" stroke="currentColor" stroke-width="2"/>
            </svg>
        </button>
    </div>

    <!-- Message Display -->
    <div class="cafe-message" id="cafeMessage"></div>

    <!-- Main Canvas -->
    <canvas id="cat-cafe-canvas"></canvas>

    <!-- Wand Mini-Game Overlay -->
    <div class="wand-game-overlay" id="wandGameOverlay" style="display: none;">
        <div class="wand-game-modal">
            <button class="wand-game-close" id="wandGameClose">‚úï</button>

            <h2>üêæ Cat Wand Game</h2>
            <p class="wand-game-instructions">Click the wand before it disappears!</p>

            <div class="wand-game-stats">
                <div class="stat-item">
                    <span class="stat-label">Score</span>
                    <span class="stat-value" id="wandScore">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Time</span>
                    <span class="stat-value" id="wandTime">30</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Best</span>
                    <span class="stat-value" id="wandBest">0</span>
                </div>
            </div>

            <div class="wand-game-area" id="wandGameArea">
                <!-- Wand positions -->
                <div class="wand-position left" data-position="0"></div>
                <div class="wand-position middle" data-position="1"></div>
                <div class="wand-position right" data-position="2"></div>

                <!-- Wand element -->
                <div class="wand" id="wand" style="display: none;">
                    <svg class="wand-image" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <!-- BASE/HANDLE at top center (this stays fixed at top) -->
                        <circle cx="100" cy="15" r="8" fill="#6D5D4B" opacity="0.8"/>
                        <circle cx="100" cy="15" r="5" fill="#8B7355" opacity="0.6"/>

                        <!-- Wooden stick extending downward from base -->
                        <line x1="100" y1="15" x2="100" y2="130" stroke="#8B7355" stroke-width="4" stroke-linecap="round"/>
                        <line x1="100" y1="15" x2="100" y2="130" stroke="#A68A6E" stroke-width="2" stroke-linecap="round" opacity="0.6"/>

                        <!-- String/cord at the tip -->
                        <path d="M 100 130 Q 102 135, 100 140" stroke="#D4AF37" stroke-width="1.5" fill="none" stroke-linecap="round"/>

                        <!-- FEATHERS at the tip/bottom (the clickable target area) -->
                        <!-- Pink feather 1 - Realistic shape -->
                        <g transform="rotate(-15 100 155)">
                            <animate attributeName="transform" values="rotate(-15 100 155);rotate(-12 100 155);rotate(-18 100 155);rotate(-15 100 155)" dur="2s" repeatCount="indefinite"/>
                            <!-- Feather shaft -->
                            <line x1="100" y1="140" x2="100" y2="180" stroke="#D4669C" stroke-width="1.5" opacity="0.9"/>
                            <!-- Feather vane - left side -->
                            <path d="M 100 140 Q 90 150, 88 160 Q 89 165, 92 170 Q 95 175, 100 180"
                                  fill="url(#pinkGrad)" stroke="#FF6B9D" stroke-width="0.5" opacity="0.95"/>
                            <!-- Feather vane - right side -->
                            <path d="M 100 140 Q 110 150, 112 160 Q 111 165, 108 170 Q 105 175, 100 180"
                                  fill="url(#pinkGrad)" stroke="#FF6B9D" stroke-width="0.5" opacity="0.95"/>
                            <!-- Barbs detail -->
                            <path d="M 100 145 L 95 148 M 100 150 L 94 154 M 100 155 L 93 160 M 100 160 L 94 165 M 100 165 L 96 170"
                                  stroke="#FF8FB3" stroke-width="0.3" opacity="0.6"/>
                            <path d="M 100 145 L 105 148 M 100 150 L 106 154 M 100 155 L 107 160 M 100 160 L 106 165 M 100 165 L 104 170"
                                  stroke="#FF8FB3" stroke-width="0.3" opacity="0.6"/>
                        </g>

                        <!-- Purple feather 2 - Realistic shape -->
                        <g transform="rotate(5 115 160)">
                            <animate attributeName="transform" values="rotate(5 115 160);rotate(8 115 160);rotate(2 115 160);rotate(5 115 160)" dur="2.3s" repeatCount="indefinite"/>
                            <!-- Feather shaft -->
                            <line x1="115" y1="145" x2="115" y2="182" stroke="#9551C7" stroke-width="1.5" opacity="0.9"/>
                            <!-- Feather vane - left side -->
                            <path d="M 115 145 Q 106 155, 104 165 Q 105 170, 108 176 Q 111 180, 115 182"
                                  fill="url(#purpleGrad)" stroke="#B565D8" stroke-width="0.5" opacity="0.95"/>
                            <!-- Feather vane - right side -->
                            <path d="M 115 145 Q 124 155, 126 165 Q 125 170, 122 176 Q 119 180, 115 182"
                                  fill="url(#purpleGrad)" stroke="#B565D8" stroke-width="0.5" opacity="0.95"/>
                            <!-- Barbs detail -->
                            <path d="M 115 150 L 110 154 M 115 155 L 109 160 M 115 160 L 108 166 M 115 165 L 110 171 M 115 170 L 111 175"
                                  stroke="#C78BE8" stroke-width="0.3" opacity="0.6"/>
                            <path d="M 115 150 L 120 154 M 115 155 L 121 160 M 115 160 L 122 166 M 115 165 L 120 171 M 115 170 L 119 175"
                                  stroke="#C78BE8" stroke-width="0.3" opacity="0.6"/>
                        </g>

                        <!-- Bright pink/magenta feather 3 - Realistic shape -->
                        <g transform="rotate(-25 85 158)">
                            <animate attributeName="transform" values="rotate(-25 85 158);rotate(-22 85 158);rotate(-28 85 158);rotate(-25 85 158)" dur="1.8s" repeatCount="indefinite"/>
                            <!-- Feather shaft -->
                            <line x1="85" y1="143" x2="85" y2="178" stroke="#E63871" stroke-width="1.5" opacity="0.9"/>
                            <!-- Feather vane - left side -->
                            <path d="M 85 143 Q 77 152, 75 162 Q 76 167, 78 172 Q 81 176, 85 178"
                                  fill="url(#magentaGrad)" stroke="#FF4081" stroke-width="0.5" opacity="0.95"/>
                            <!-- Feather vane - right side -->
                            <path d="M 85 143 Q 93 152, 95 162 Q 94 167, 92 172 Q 89 176, 85 178"
                                  fill="url(#magentaGrad)" stroke="#FF4081" stroke-width="0.5" opacity="0.95"/>
                            <!-- Barbs detail -->
                            <path d="M 85 148 L 81 152 M 85 153 L 80 158 M 85 158 L 79 164 M 85 163 L 80 169 M 85 168 L 82 173"
                                  stroke="#FF80AB" stroke-width="0.3" opacity="0.6"/>
                            <path d="M 85 148 L 89 152 M 85 153 L 90 158 M 85 158 L 91 164 M 85 163 L 90 169 M 85 168 L 88 173"
                                  stroke="#FF80AB" stroke-width="0.3" opacity="0.6"/>
                        </g>

                        <!-- Light blue feather 4 - Realistic shape -->
                        <g transform="rotate(10 108 170)">
                            <animate attributeName="transform" values="rotate(10 108 170);rotate(13 108 170);rotate(7 108 170);rotate(10 108 170)" dur="2.1s" repeatCount="indefinite"/>
                            <!-- Feather shaft -->
                            <line x1="108" y1="155" x2="108" y2="188" stroke="#5AA3E6" stroke-width="1.5" opacity="0.9"/>
                            <!-- Feather vane - left side -->
                            <path d="M 108 155 Q 100 164, 98 174 Q 99 179, 101 184 Q 104 187, 108 188"
                                  fill="url(#blueGrad)" stroke="#64B5F6" stroke-width="0.5" opacity="0.95"/>
                            <!-- Feather vane - right side -->
                            <path d="M 108 155 Q 116 164, 118 174 Q 117 179, 115 184 Q 112 187, 108 188"
                                  fill="url(#blueGrad)" stroke="#64B5F6" stroke-width="0.5" opacity="0.95"/>
                            <!-- Barbs detail -->
                            <path d="M 108 160 L 104 164 M 108 165 L 103 170 M 108 170 L 102 176 M 108 175 L 103 181 M 108 180 L 105 184"
                                  stroke="#90CAF9" stroke-width="0.3" opacity="0.6"/>
                            <path d="M 108 160 L 112 164 M 108 165 L 113 170 M 108 170 L 114 176 M 108 175 L 113 181 M 108 180 L 111 184"
                                  stroke="#90CAF9" stroke-width="0.3" opacity="0.6"/>
                        </g>

                        <!-- Yellow/orange feather 5 - Realistic shape -->
                        <g transform="rotate(-8 92 168)">
                            <animate attributeName="transform" values="rotate(-8 92 168);rotate(-5 92 168);rotate(-11 92 168);rotate(-8 92 168)" dur="2.5s" repeatCount="indefinite"/>
                            <!-- Feather shaft -->
                            <line x1="92" y1="156" x2="92" y2="183" stroke="#E8B844" stroke-width="1.3" opacity="0.9"/>
                            <!-- Feather vane - left side -->
                            <path d="M 92 156 Q 86 164, 84 172 Q 85 176, 87 179 Q 89 181, 92 183"
                                  fill="url(#yellowGrad)" stroke="#FFD54F" stroke-width="0.5" opacity="0.95"/>
                            <!-- Feather vane - right side -->
                            <path d="M 92 156 Q 98 164, 100 172 Q 99 176, 97 179 Q 95 181, 92 183"
                                  fill="url(#yellowGrad)" stroke="#FFD54F" stroke-width="0.5" opacity="0.95"/>
                            <!-- Barbs detail -->
                            <path d="M 92 161 L 89 165 M 92 166 L 88 171 M 92 171 L 87 176 M 92 176 L 89 180"
                                  stroke="#FFEB99" stroke-width="0.3" opacity="0.6"/>
                            <path d="M 92 161 L 95 165 M 92 166 L 96 171 M 92 171 L 97 176 M 92 176 L 95 180"
                                  stroke="#FFEB99" stroke-width="0.3" opacity="0.6"/>
                        </g>

                        <!-- Gradient definitions for realistic feather colors -->
                        <defs>
                            <linearGradient id="pinkGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#FF8FB3;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#FF6B9D;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#E05588;stop-opacity:0.9" />
                            </linearGradient>
                            <linearGradient id="purpleGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#C78BE8;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#B565D8;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#8E44AD;stop-opacity:0.9" />
                            </linearGradient>
                            <linearGradient id="magentaGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#FF80AB;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#FF4081;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#E63871;stop-opacity:0.9" />
                            </linearGradient>
                            <linearGradient id="blueGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#90CAF9;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#64B5F6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#5AA3E6;stop-opacity:0.9" />
                            </linearGradient>
                            <linearGradient id="yellowGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#FFEB99;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#FFD54F;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#E8B844;stop-opacity:0.9" />
                            </linearGradient>
                        </defs>

                        <!-- Bell at attachment point -->
                        <circle cx="100" cy="135" r="4" fill="#FFD700" stroke="#DAA520" stroke-width="0.5"/>
                        <circle cx="100" cy="135" r="2" fill="#FFF" opacity="0.6"/>
                    </svg>
                </div>

                <!-- Cat paw -->
                <div class="cat-paw" id="catPaw">
                    <div class="paw-pad"></div>
                    <div class="paw-toe"></div>
                    <div class="paw-toe"></div>
                    <div class="paw-toe"></div>
                </div>
            </div>

            <button class="wand-game-start" id="wandGameStart">Start Game</button>

            <div class="wand-leaderboard">
                <h3>üèÜ Leaderboard</h3>
                <ol id="wandLeaderboardList">
                    <li>No scores yet</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Yarn Ball Bounce Mini-Game Overlay -->
    <div class="yarn-game-overlay" id="yarnGameOverlay" style="display: none;">
        <div class="yarn-game-modal">
            <button class="yarn-game-close" id="yarnGameClose">‚úï</button>

            <h2>üß∂ Yarn Ball Bounce</h2>
            <p class="yarn-game-instructions">Click yarn balls to bat them away! Don't let them reach the bottom!</p>

            <div class="yarn-game-stats">
                <div class="stat-item">
                    <span class="stat-label">Score</span>
                    <span class="stat-value" id="yarnScore">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Lives</span>
                    <span class="stat-value" id="yarnLives">3</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Best</span>
                    <span class="stat-value" id="yarnBest">0</span>
                </div>
            </div>

            <canvas id="yarnCanvas" width="500" height="400"></canvas>

            <button class="yarn-game-start" id="yarnGameStart">Start Game</button>

            <div class="yarn-leaderboard">
                <h3>üèÜ Leaderboard</h3>
                <ol id="yarnLeaderboardList">
                    <li>No scores yet</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Meow Melody Mini-Game Overlay -->
    <div class="melody-game-overlay" id="melodyGameOverlay" style="display: none;">
        <div class="melody-game-modal">
            <button class="melody-game-close" id="melodyGameClose">‚úï</button>

            <h2>üéµ Meow Melody</h2>
            <p class="melody-game-instructions">Watch the pattern, then repeat it!</p>

            <div class="melody-game-stats">
                <div class="stat-item">
                    <span class="stat-label">Round</span>
                    <span class="stat-value" id="melodyRound">1</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Score</span>
                    <span class="stat-value" id="melodyScore">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Best</span>
                    <span class="stat-value" id="melodyBest">0</span>
                </div>
            </div>

            <div class="melody-game-area" id="melodyGameArea">
                <div class="melody-toys">
                    <div class="melody-toy ball" data-toy="0" data-sound="meow1">
                        <div class="toy-icon">üî¥</div>
                        <div class="toy-label">Ball</div>
                    </div>
                    <div class="melody-toy mouse" data-toy="1" data-sound="meow2">
                        <div class="toy-icon">üê≠</div>
                        <div class="toy-label">Mouse</div>
                    </div>
                    <div class="melody-toy feather" data-toy="2" data-sound="meow3">
                        <div class="toy-icon">ü™∂</div>
                        <div class="toy-label">Feather</div>
                    </div>
                    <div class="melody-toy fish" data-toy="3" data-sound="meow4">
                        <div class="toy-icon">üêü</div>
                        <div class="toy-label">Fish</div>
                    </div>
                </div>
            </div>

            <button class="melody-game-start" id="melodyGameStart">Start Game</button>

            <div class="melody-leaderboard">
                <h3>üèÜ Leaderboard</h3>
                <ol id="melodyLeaderboardList">
                    <li>No scores yet</li>
                </ol>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/cat-cafe-game.js') }}"></script>
{% endblock %}
